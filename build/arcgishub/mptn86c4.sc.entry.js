const e=window.arcgishub.h;var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,r)},r=function(){return(r=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function n(e){return Object.keys(e).some(function(t){var r=e[t];if(!r)return!1;switch(r.constructor.name){case"Array":case"Object":case"Date":case"Function":case"Boolean":case"String":case"Number":return!1;default:return!0}})}function o(e){var t={};return Object.keys(e).forEach(function(r){var n=e[r];if(n||0===n||"boolean"==typeof n||"string"==typeof n){var o;switch(n.constructor.name){case"Array":o=n[0]&&n[0].constructor&&"Object"===n[0].constructor.name?JSON.stringify(n):n.join(",");break;case"Object":o=JSON.stringify(n);break;case"Date":o=n.valueOf();break;case"Function":o=null;break;case"Boolean":o=n+"";break;default:o=n}(o||0===o||"string"==typeof o)&&(t[r]=o)}}),t}function i(e){var t=o(e);return Object.keys(t).map(function(e){return function(e,t){return encodeURIComponent(e)+"="+encodeURIComponent(t)}(e,t[e])}).join("&")}var s=function(e,t,r,n,o){e=e||"UNKNOWN_ERROR",t=t||"UNKNOWN_ERROR_CODE",this.name="ArcGISRequestError",this.message="UNKNOWN_ERROR_CODE"===t?e:t+": "+e,this.originalMessage=e,this.code=t,this.response=r,this.url=n,this.options=o};s.prototype=Object.create(Error.prototype),s.prototype.constructor=s;var a="@esri/arcgis-rest-js";function h(e,t){void 0===t&&(t={params:{f:"json"}});var h=r({httpMethod:"POST"},t),u=[],p=[];if(h.fetch||"undefined"==typeof fetch?(u.push("`fetch`"),p.push("`isomorphic-fetch`")):h.fetch=fetch.bind(Function("return this")()),"undefined"==typeof Promise&&(u.push("`Promise`"),p.push("`es6-promise`")),"undefined"==typeof FormData&&(u.push("`FormData`"),p.push("`isomorphic-form-data`")),!h.fetch||"undefined"==typeof Promise||"undefined"==typeof FormData)throw new Error("`arcgis-rest-request` requires global variables for `fetch`, `Promise` and `FormData` to be present in the global scope. You are missing "+u.join(", ")+". We recommend installing the "+p.join(", ")+" modules at the root of your application to add these to the global scope. See https://bit.ly/2KNwWaJ for more info.");var l=h.httpMethod,f=h.authentication,d=h.rawResponse,k=r({f:"json"},t.params),m={method:l,credentials:"same-origin"};return(f?f.getToken(e,{fetch:h.fetch}):Promise.resolve("")).then(function(s){if(s.length&&(k.token=s),"GET"===m.method){var u=""===i(k)?e:e+"?"+i(k);h.maxUrlLength&&u.length>h.maxUrlLength?m.method="POST":e=u}return"POST"===m.method&&(m.body=function(e){var t=n(e),r=o(e);if(t){var s=new FormData;return Object.keys(r).forEach(function(e){"undefined"!=typeof Blob&&r[e]instanceof Blob?s.append(e,r[e],r.fileName||r[e].name||e):s.append(e,r[e])}),s}return i(e)}(k)),m.headers=r({},t.headers),"undefined"!=typeof window||m.headers.referer||(m.headers.referer=a),n(k)||(m.headers["Content-Type"]="application/x-www-form-urlencoded"),h.fetch(e,m)}).then(function(t){if(!t.ok)throw new s(t.statusText,"HTTP "+t.status,t,e,h);if(d)return t;switch(k.f){case"json":case"geojson":return t.json();case"html":case"text":return t.text();default:return t.blob()}}).then(function(t){return"json"!==k.f&&"geojson"!==k.f||d?t:function(e,t,r,n){if(e.code>=400)throw new s(i=e.message,a=e.code,e,t,n);if(e.error){var o=e.error,i=o.message,a=o.code,h=o.messageCode,u=h||a||"UNKNOWN_ERROR_CODE";if(498===a||499===a||"GWM_0003"===h||400===a&&"Unable to generate token."===i)throw new c(i,u,e,t,n);throw new s(i,u,e,t,n)}if("failed"===e.status||"failure"===e.status){i=void 0,a="UNKNOWN_ERROR_CODE";try{i=JSON.parse(e.statusMessage).message,a=JSON.parse(e.statusMessage).code}catch(t){i=e.statusMessage||e.message}throw new s(i,a,e,t,n)}return e}(t,e,0,h)})}var u,c=function(e){function n(t,r,n,o,i){void 0===t&&(t="AUTHENTICATION_ERROR"),void 0===r&&(r="AUTHENTICATION_ERROR_CODE");var s=e.call(this,t,r,n,o,i)||this;return s.name="ArcGISAuthError",s.message="AUTHENTICATION_ERROR_CODE"===r?t:r+": "+t,s}return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}(n,e),n.prototype.retry=function(e,t){var n=this;void 0===t&&(t=3);var o=0,i=function(s,a){e(n.url,n.options).then(function(e){var t=r({},n.options,{authentication:e});return o+=1,h(n.url,t)}).then(function(e){s(e)}).catch(function(e){"ArcGISAuthError"===e.name&&o<t?i(s,a):a("ArcGISAuthError"===e.name&&o>=t?n:e)})};return new Promise(function(e,t){i(e,t)})},n}(s);function p(e){return"/"===(e=e.trim())[e.length-1]&&(e=e.slice(0,-1)),e}function l(e,t){var r=t.params?t:{params:t};return r.rawResponse=!1,h(e,r).then(function(e){var t={token:e.access_token,username:e.username,expires:new Date(Date.now()+(1e3*e.expires_in-1e3)),ssl:!0===e.ssl};return e.refresh_token&&(t.refreshToken=e.refresh_token),t})}function f(e,t){var r=t.params?t:{params:t};return r.params.referer="undefined"!=typeof window&&window.location&&window.location.host?window.location.host:a,h(e,r)}!function(e){e.ArcGISRequestError="ArcGISRequestError",e.ArcGISAuthError="ArcGISAuthError"}(u||(u={}));var d=function(){function e(e){if(this.clientId=e.clientId,this._refreshToken=e.refreshToken,this._refreshTokenExpires=e.refreshTokenExpires,this.username=e.username,this.password=e.password,this._token=e.token,this._tokenExpires=e.tokenExpires,this.portal=e.portal?p(e.portal):"https://www.arcgis.com/sharing/rest",this.ssl=e.ssl,this.provider=e.provider||"arcgis",this.tokenDuration=e.tokenDuration||20160,this.redirectUri=e.redirectUri,this.refreshTokenTTL=e.refreshTokenTTL||1440,this.trustedServers={},e.server){var t=e.server.toLowerCase().split(/\/rest(\/admin)?\/services\//)[0];this.trustedServers[t]={token:e.token,expires:e.tokenExpires}}this._pendingTokenRequests={}}return e.beginOAuth2=function(t,n){void 0===n&&(n=window);var o,i=r({portal:"https://www.arcgis.com/sharing/rest",provider:"arcgis",duration:20160,popup:!0,state:t.clientId,locale:""},t),s=i.portal,a=i.provider,h=i.clientId,u=i.duration,p=i.redirectUri,l=i.popup,f=i.state,d=i.locale;if(o="arcgis"===a?s+"/oauth2/authorize?client_id="+h+"&response_type=token&expiration="+u+"&redirect_uri="+encodeURIComponent(p)+"&state="+f+"&locale="+d:s+"/oauth2/social/authorize?client_id="+h+"&socialLoginProviderName="+a+"&autoAccountCreateForSocial=true&response_type=token&expiration="+u+"&redirect_uri="+encodeURIComponent(p)+"&state="+f+"&locale="+d,l){var k,m=((k={promise:null,resolve:null,reject:null}).promise=new Promise(function(e,t){k.resolve=e,k.reject=t}),k);return n["__ESRI_REST_AUTH_HANDLER_"+h]=function(t,r){if(t){var n=JSON.parse(t);m.reject(new c(n.errorMessage,n.error))}else if(r){var o=JSON.parse(r);m.resolve(new e({clientId:h,portal:s,ssl:o.ssl,token:o.token,tokenExpires:new Date(o.expires),username:o.username}))}},n.open(o,"oauth-window","height=400,width=600,menubar=no,location=yes,resizable=yes,scrollbars=yes,status=yes"),m.promise}n.location.href=o},e.completeOAuth2=function(t,n){void 0===n&&(n=window);var o=r({portal:"https://www.arcgis.com/sharing/rest"},t),i=o.portal,s=o.clientId;function a(t,r){if(n.opener&&n.opener.parent)return n.opener.parent["__ESRI_REST_AUTH_HANDLER_"+s](t?JSON.stringify(t):void 0,JSON.stringify(r)),void n.close();if(n!==n.parent)return n.parent["__ESRI_REST_AUTH_HANDLER_"+s](t?JSON.stringify(t):void 0,JSON.stringify(r)),void n.close();if(t)throw new c(t.errorMessage,t.error);return new e({clientId:s,portal:i,ssl:r.ssl,token:r.token,tokenExpires:r.expires,username:r.username})}var h=n.location.href.match(/access_token=(.+)&expires_in=(.+)&username=([^&]+)/);if(!h){var u=n.location.href.match(/error=(.+)&error_description=(.+)/);return a({error:u[1],errorMessage:decodeURIComponent(u[2])})}var p=h[1],l=new Date(Date.now()+1e3*parseInt(h[2],10)-6e4),f=decodeURIComponent(h[3]);return a(void 0,{token:p,expires:l,ssl:n.location.href.indexOf("&ssl=true")>-1||n.location.href.indexOf("#ssl=true")>-1,username:f})},e.authorize=function(e,t){var n=r({portal:"https://arcgis.com/sharing/rest",duration:20160},e);t.writeHead(301,{Location:n.portal+"/oauth2/authorize?client_id="+n.clientId+"&duration="+n.duration+"&response_type=code&redirect_uri="+encodeURIComponent(n.redirectUri)}),t.end()},e.exchangeAuthorizationCode=function(t,n){var o=r({portal:"https://www.arcgis.com/sharing/rest",refreshTokenTTL:1440},t),i=o.portal,s=o.clientId,a=o.redirectUri,h=o.refreshTokenTTL;return l(i+"/oauth2/token",{grant_type:"authorization_code",client_id:s,redirect_uri:a,code:n}).then(function(t){return new e({clientId:s,portal:i,ssl:t.ssl,redirectUri:a,refreshToken:t.refreshToken,refreshTokenTTL:h,refreshTokenExpires:new Date(Date.now()+1e3*(h-1)),token:t.token,tokenExpires:t.expires,username:t.username})})},e.deserialize=function(t){var r=JSON.parse(t);return new e({clientId:r.clientId,refreshToken:r.refreshToken,refreshTokenExpires:new Date(r.refreshTokenExpires),username:r.username,password:r.password,token:r.token,tokenExpires:new Date(r.tokenExpires),portal:r.portal,ssl:r.ssl,tokenDuration:r.tokenDuration,redirectUri:r.redirectUri,refreshTokenTTL:r.refreshTokenTTL})},e.fromCredential=function(t){return new e({portal:t.server.includes("sharing/rest")?t.server:t.server+"/sharing/rest",ssl:t.ssl,token:t.token,username:t.userId,tokenExpires:new Date(t.expires)})},Object.defineProperty(e.prototype,"token",{get:function(){return this._token},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tokenExpires",{get:function(){return this._tokenExpires},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"refreshToken",{get:function(){return this._refreshToken},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"refreshTokenExpires",{get:function(){return this._refreshTokenExpires},enumerable:!0,configurable:!0}),e.prototype.toCredential=function(){return{expires:this.tokenExpires.getTime(),server:this.portal,ssl:this.ssl,token:this.token,userId:this.username}},e.prototype.getUser=function(e){var t=this;return this._user&&this._user.username===this.username?Promise.resolve(this._user):h(this.portal+"/community/users/"+encodeURIComponent(this.username),r({httpMethod:"GET",authentication:this},e,{rawResponse:!1})).then(function(e){return t._user=e,e})},e.prototype.getToken=function(e,t){return/^https?:\/\/\S+\.arcgis\.com\/sharing\/rest/.test(this.portal)&&/^https?:\/\/\S+\.arcgis\.com.+/.test(e)?this.getFreshToken(t):new RegExp(this.portal,"i").test(e)?this.getFreshToken(t):this.getTokenForServer(e,t)},e.prototype.toJSON=function(){return{clientId:this.clientId,refreshToken:this.refreshToken,refreshTokenExpires:this.refreshTokenExpires,username:this.username,password:this.password,token:this.token,tokenExpires:this.tokenExpires,portal:this.portal,ssl:this.ssl,tokenDuration:this.tokenDuration,redirectUri:this.redirectUri,refreshTokenTTL:this.refreshTokenTTL}},e.prototype.serialize=function(){return JSON.stringify(this)},e.prototype.refreshSession=function(e){return this._user=null,this.username&&this.password?this.refreshWithUsernameAndPassword(e):this.clientId&&this.refreshToken?this.refreshWithRefreshToken():Promise.reject(new c("Unable to refresh token."))},e.prototype.getTokenForServer=function(e,t){var r=this,n=e.toLowerCase().split(/\/rest(\/admin)?\/services\//)[0],o=this.trustedServers[n];return o&&o.expires&&o.expires.getTime()>Date.now()?Promise.resolve(o.token):this._pendingTokenRequests[n]?this._pendingTokenRequests[n]:(this._pendingTokenRequests[n]=h(n+"/rest/info").then(function(o){if(o.owningSystemUrl){if(new RegExp(o.owningSystemUrl,"i").test(r.portal))return h(o.owningSystemUrl+"/sharing/rest/info",t);throw new c(e+" is not federated with "+r.portal+".","NOT_FEDERATED")}if(o.authInfo&&void 0!==r.trustedServers[n])return Promise.resolve({authInfo:o.authInfo});throw new c(e+" is not federated with any portal and is not explicitly trusted.","NOT_FEDERATED")}).then(function(e){return e.authInfo.tokenServicesUrl}).then(function(t){return r.token&&r.tokenExpires.getTime()>Date.now()?f(t,{params:{token:r.token,serverUrl:e,expiration:r.tokenDuration,client:"referer"}}):f(t,{params:{username:r.username,password:r.password,expiration:r.tokenDuration,client:"referer"}}).then(function(e){return r._token=e.token,r._tokenExpires=new Date(e.expires),e})}).then(function(e){return r.trustedServers[n]={expires:new Date(e.expires),token:e.token},e.token}),this._pendingTokenRequests[n])},e.prototype.getFreshToken=function(e){var t=this;return this.token&&this.tokenExpires&&this.tokenExpires.getTime()>Date.now()?Promise.resolve(this.token):(this._pendingTokenRequests[this.portal]||(this._pendingTokenRequests[this.portal]=this.refreshSession(e).then(function(e){return t._pendingTokenRequests[t.portal]=null,e.token})),this._pendingTokenRequests[this.portal])},e.prototype.refreshWithUsernameAndPassword=function(e){var t=this,n=r({params:{username:this.username,password:this.password,expiration:this.tokenDuration}},e);return f(this.portal+"/generateToken",n).then(function(e){return t._token=e.token,t._tokenExpires=new Date(e.expires),t})},e.prototype.refreshWithRefreshToken=function(e){var t=this;if(this.refreshToken&&this.refreshTokenExpires&&this.refreshTokenExpires.getTime()<Date.now())return this.refreshRefreshToken(e);var n=r({params:{client_id:this.clientId,refresh_token:this.refreshToken,grant_type:"refresh_token"}},e);return l(this.portal+"/oauth2/token",n).then(function(e){return t._token=e.token,t._tokenExpires=e.expires,t})},e.prototype.refreshRefreshToken=function(e){var t=this,n=r({params:{client_id:this.clientId,refresh_token:this.refreshToken,redirect_uri:this.redirectUri,grant_type:"exchange_refresh_token"}},e);return l(this.portal+"/oauth2/token",n).then(function(e){return t._token=e.token,t._tokenExpires=e.expires,t._refreshToken=e.refreshToken,t._refreshTokenExpires=new Date(Date.now()+60*(t.refreshTokenTTL-1)*1e3),t})},e}();function k(e){return void 0===(t=e)&&(t={}),(t.portal?p(t.portal):t.authentication?t.authentication.portal:"https://www.arcgis.com/sharing/rest")+"/community/users/"+encodeURIComponent(e.username);var t}var m=function(e){return"hubInitiativeId|"+e},g=function(e){return k(e)+"/update"},w=function(e,t){return function(e){return e.tags.map(function(e){return e.replace(/^hubInitiativeId\|/,"")})}(e).indexOf(t)>-1};class T{constructor(){this.orgurl="https://www.arcgis.com",this.following=!1,this.callToActionText="Follow Our Initiative",this.toggleFollow=(()=>{this.following?function(e){return h(k(e.authentication),{authentication:e.authentication}).then(function(t){if(!w(t,e.initiativeId))return Promise.reject("user is not following this initiative.");var r=m(e.initiativeId),n=JSON.parse(JSON.stringify(t.tags)),o=n.indexOf(r);return n.splice(o,1),0===n.length&&n.push(","),h(g(e.authentication),{params:{tags:n},authentication:e.authentication})})}({initiativeId:this.initiativeid,authentication:this.session}).then(e=>{}).catch(e=>{}).then(()=>{this.following=!1,this.callToActionText="Follow Our Inititiave"}):function(e){return h(k(e.authentication),{authentication:e.authentication}).then(function(t){if(w(t,e.initiativeId))return Promise.reject("user is already following this initiative.");var r=m(e.initiativeId),n=JSON.parse(JSON.stringify(t.tags));return n.push(r),h(g(e.authentication),{params:{tags:n},authentication:e.authentication})})}({initiativeId:this.initiativeid,authentication:this.session}).then(e=>{}).catch(e=>{}).then(()=>{this.following=!0,this.callToActionText="Unfollow Our Inititiave"})})}handleKeyDown(){this.session?this.toggleFollow():d.beginOAuth2({clientId:this.clientid,portal:`${this.orgurl}/sharing/rest`,redirectUri:`${window.location}authenticate.html`}).then(e=>{this.session=e,this.toggleFollow()})}render(){return e("button",{class:"btn"},e("svg",{draggable:"auto",class:"follow-icon",viewBox:"0 0 120 120",width:"100%",height:"100%"},e("circle",{cx:"18.385",cy:"101.615",r:"18.385"}),e("path",{d:"M-1.031 61c32.533 0 59 26.468 59 59s-26.467 59-59 59-59-26.468-59-59 26.467-59 59-59m0-23c-45.288 0-82 36.713-82 82s36.712 82 82 82 82-36.713 82-82-36.712-82-82-82z"}),e("path",{d:"M.154 23.041c53.349 0 96.75 43.402 96.75 96.75s-43.402 96.75-96.75 96.75-96.75-43.402-96.75-96.75 43.402-96.75 96.75-96.75m0-23c-66.136 0-119.75 53.615-119.75 119.75s53.614 119.75 119.75 119.75c66.135 0 119.75-53.615 119.75-119.75S66.289.041.154.041z"})),this.callToActionText)}static get is(){return"hub-follow-button"}static get encapsulation(){return"shadow"}static get properties(){return{callToActionText:{state:!0},clientid:{type:String,attr:"clientid"},following:{type:Boolean,attr:"following",mutable:!0},initiativeid:{type:String,attr:"initiativeid"},orgurl:{type:String,attr:"orgurl"},session:{type:"Any",attr:"session",mutable:!0},user:{type:"Any",attr:"user",mutable:!0}}}static get listeners(){return[{name:"click",method:"handleKeyDown"}]}static get style(){return".btn.sc-hub-follow-button{position:relative;display:inline-block;padding:.375rem 1rem;width:auto;color:#fff;border:1px solid #0079c1;border-radius:0;background-color:#0079c1;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;-webkit-transition:all .05s linear;transition:all .05s linear;cursor:pointer;white-space:nowrap;font-size:.9375rem;line-height:1.5}.btn.sc-hub-follow-button:hover{text-decoration:none;color:#fff;background-color:#005e95;border-color:#005e95}.follow-icon.sc-hub-follow-button{height:15px;width:15px;vertical-align:baseline;padding-right:5px;fill:currentColor}"}}export{T as HubFollowButton};