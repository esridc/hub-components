const t=window.arcgishub.h;import{a as e,b as r,c as i,d as n,e as s,f as a,g as u,h as o,i as l}from"./chunk-db12ebb6.js";function c(t){var n={httpMethod:"GET",params:{}};"string"==typeof t?n.params.q=t:(n=e({},n,t)).params=e({},t.params,t.searchForm);var s=r(n)+"/search";return i(s,n)}function h(t,e,r,i){var n=[],s=[],a=[],u=(new Date).getTime(),o="";if(t.forEach(function(t){var r=t.attributes,a=t.geometry,l=null;if(r.imageAttributes){var c=JSON.parse(r.imageAttributes);c.crop&&(l=e+"/"+r.OBJECTID+"/attachments/"+c.crop+"?v="+u,i&&(l+="&token="+i))}s.push({id:r.OBJECTID,type:"events",imageUrl:l,attributes:r,geometry:a});var h=r.siteId;null!=h&&-1===n.indexOf(h)&&(n.push(h),o+=o.length>0?" OR id:":"id:",o+=h)}),0===n.length)return{included:a,data:s};var l=r;return l.searchForm={q:o},c(l).then(function(t){return t.results.forEach(function(t){a.push({id:t.id,type:"sites",attributes:{id:t.id,url:t.url}})}),{included:a,data:s}})}class d{constructor(){this.orgurl="https://www.arcgis.com",this.callToActionText="Attend",this.triggerRegister=(()=>(this.session=a(),this.session?this.toggleRegister():u.beginOAuth2({clientId:this.clientid,portal:`${this.orgurl}/sharing/rest`,redirectUri:`${window.location}authenticate.html`}).then(t=>(o(t),this.session=t.serialize(),this.toggleRegister())))),this.toggleRegister=(()=>this.attending?function(t){return function(t){var e=r(t)+"/community/groups/"+t.id+"/leave";return i(e,t)}({id:t.groupId,authentication:t.authentication})}({groupId:this.eventGroupId,authentication:u.deserialize(this.session)}).then(t=>!0===t.success?(this.callToActionText="Attend",this.attending=!1,{success:!0}):{success:!1}):function(t){return function(t){var e=r(t)+"/community/groups/"+t.id+"/join";return i(e,t)}({id:t.groupId,authentication:t.authentication})}({groupId:this.eventGroupId,authentication:u.deserialize(this.session)}).then(t=>{if(!0===t.success)return Promise.resolve()}).catch(t=>{if("User is already a member of group."===t.originalMessage)return Promise.resolve();throw t}).then(()=>(this.callToActionText="Attending",this.attending=!0,{success:!0})))}componentDidLoad(){l(null,{portal:`${this.orgurl}/sharing/rest/`}).then(t=>{(function(r,i){return c(e({searchForm:{q:"typekeywords:hubEventsLayer AND orgid:"+t.id}},void 0)).then(function(t){if(t.results&&t.results.length>0){var e=void 0;if(1===t.results.length)e=t.results[0];else if(t.results.length>1){var r=t.results.reduce(function(t,e){return e.typeKeywords.includes("View Service")?"public"===e.access?t.public=e:t.org=e:t.admin=e,t},{});e=r.admin||r.org||r.public}var i=e.url+"/0";return i.replace(/^http:/gi,"https:")}throw Error("No events service found. Events are likely not enabled.")})})().then(t=>{this.eventServiceUrl=t,function(t){var r=e({returnGeometry:!0},t);return function(t){var r=e({params:{},httpMethod:"GET",url:t.url},t);return n(t,r),r.params.where||(r.params.where="1=1"),r.params.outFields||(r.params.outFields="*"),i(s(r.url)+"/query",r)}(r).then(function(e){return e.features.length<=0?{data:[],included:[]}:r.authentication?r.authentication.getToken(r.url).then(function(i){return h(e.features,r.url,t,i)}):h(e.features,r.url,t)})}({url:this.eventServiceUrl}).then(t=>{if(t.data.length>0)for(let e=0;e<t.data.length;e++)if(t.data[e].attributes.title===this.eventtitle){const r=t.data[e].attributes;this.eventDate=new Date(r.startDate).toString(),this.eventGroupId=r.groupId,this.eventOrganizer=this.digOutContactInfo(r);break}})})})}digOutContactInfo(e){const r=JSON.parse(e.organizers);if(r.length>0)return t("p",null,"organized by: ",t("a",{href:`mailto:${r[0].contact}`},r[0].name))}render(){return t("div",{class:"hub-event-details"},t("div",{class:"hub-event-background-image"}),t("div",{class:"hub-event-content"},t("h3",null,this.eventtitle),t("p",null,this.eventDate),t("p",null,this.eventOrganizer)),t("div",{class:"hub-event-footer"},t("hub-button",{text:this.callToActionText,action:this.triggerRegister})))}static get is(){return"hub-event-details"}static get properties(){return{attending:{type:Boolean,attr:"attending",mutable:!0},callToActionText:{state:!0},clientid:{type:String,attr:"clientid"},eventDate:{type:String,attr:"event-date",mutable:!0},eventGroupId:{type:String,attr:"event-group-id",mutable:!0},eventOrganizer:{type:"Any",attr:"event-organizer",mutable:!0},eventServiceUrl:{type:String,attr:"event-service-url",mutable:!0},eventtitle:{type:String,attr:"eventtitle"},orgurl:{type:String,attr:"orgurl"},session:{type:String,attr:"session",mutable:!0}}}static get style(){return".hub-event-details{border:1px solid #ccc;border-radius:4px;width:100%;color:#323232;font-size:14px;width:380px;height:400px;font-family:Arial;display:grid;grid-template-columns:auto;grid-template-rows:40% 40% 20%;grid-template-areas:\"header\" \"main\" \"footer\"}.hub-event-background-image{background-color:#ffae00;grid-area:header}.hub-event-content{grid-area:main;padding-left:40px;padding-right:40px}.hub-event-footer{grid-area:footer;padding-left:40px}"}}export{d as HubEventDetails};